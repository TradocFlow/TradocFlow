import { Colors } from "../styles/colors.slint";
import { Theme } from "../styles/default.slint";

export struct ProjectCardData {
    id: string,
    name: string,
    description: string,
    status: string,
    priority: string,
    owner-name: string,
    member-count: int,
    document-count: int,
    task-count: int,
    progress-percentage: float,
    due-date: string,
    last-activity: string,
    is-favorite: bool,
    status-color: color,
    priority-color: color,
    status-icon: string,
    priority-icon: string,
    thumbnail: string,
    tags: [string],
    languages: [string],
}

// Compact project card for grid view
export component ProjectCard inherits Rectangle {
    // Properties
    in property <ProjectCardData> project-data;
    in property <bool> selected: false;
    in property <bool> hovered: false;
    
    // Callbacks
    callback clicked(ProjectCardData);
    callback context-menu(ProjectCardData, length, length);
    callback favorite-clicked(ProjectCardData);
    
    // Styling
    width: 320px;
    height: 200px;
    border-radius: 8px;
    background: selected ? Colors.primary-light : (hovered ? Colors.surface-variant : Colors.surface);
    border-width: selected ? 2px : 1px;
    border-color: selected ? Colors.primary : Colors.outline-variant;
    drop-shadow-blur: hovered ? 8px : 4px;
    drop-shadow-color: Colors.shadow.with-alpha(0.1);
    drop-shadow-offset-y: hovered ? 4px : 2px;
    
    // Mouse interaction
    touch := TouchArea {
        clicked => {
            root.clicked(root.project-data);
        }
        
        mouse-cursor: pointer;
        
        right-clicked => {
            root.context-menu(root.project-data, self.mouse-x, self.mouse-y);
        }
    }
    
    // Content layout
    VerticalLayout {
        padding: 16px;
        spacing: 12px;
        
        // Header with title and favorite
        HorizontalLayout {
            spacing: 8px;
            alignment: stretch;
            
            // Project title and description
            VerticalLayout {
                spacing: 4px;
                
                Text {
                    text: project-data.name;
                    font-size: Theme.font-size-h4;
                    font-weight: 600;
                    color: Colors.on-surface;
                    overflow: elide;
                }
                
                Text {
                    text: project-data.description;
                    font-size: Theme.font-size-small;
                    color: Colors.on-surface-variant;
                    overflow: elide;
                    max-height: 32px;
                    wrap: word-wrap;
                }
                
                preferred-height: 60px;
            }
            
            // Favorite button
            favorite-btn := Rectangle {
                width: 32px;
                height: 32px;
                border-radius: 16px;
                background: project-data.is-favorite ? Colors.primary : transparent;
                
                Text {
                    text: project-data.is-favorite ? "⭐" : "☆";
                    color: project-data.is-favorite ? Colors.on-primary : Colors.on-surface-variant;
                    font-size: 16px;
                }
                
                favorite-touch := TouchArea {
                    mouse-cursor: pointer;
                    clicked => {
                        root.favorite-clicked(root.project-data);
                    }
                }
            }
        }
        
        // Status and priority row
        HorizontalLayout {
            spacing: 12px;
            alignment: start;
            
            // Status badge
            Rectangle {
                border-radius: 12px;
                background: project-data.status-color.with-alpha(0.1);
                border-width: 1px;
                border-color: project-data.status-color;
                
                HorizontalLayout {
                    padding-left: 8px;
                    padding-right: 8px;
                    padding-top: 4px;
                    padding-bottom: 4px;
                    spacing: 4px;
                    
                    Text {
                        text: project-data.status-icon;
                        font-size: 12px;
                    }
                    
                    Text {
                        text: project-data.status;
                        font-size: Theme.font-size-small;
                        color: project-data.status-color;
                        font-weight: 500;
                    }
                }
            }
            
            // Priority badge
            Rectangle {
                border-radius: 12px;
                background: project-data.priority-color.with-alpha(0.1);
                border-width: 1px;
                border-color: project-data.priority-color;
                
                HorizontalLayout {
                    padding-left: 8px;
                    padding-right: 8px;
                    padding-top: 4px;
                    padding-bottom: 4px;
                    spacing: 4px;
                    
                    Text {
                        text: project-data.priority-icon;
                        font-size: 12px;
                    }
                    
                    Text {
                        text: project-data.priority;
                        font-size: Theme.font-size-small;
                        color: project-data.priority-color;
                        font-weight: 500;
                    }
                }
            }
        }
        
        // Progress bar
        VerticalLayout {
            spacing: 4px;
            
            HorizontalLayout {
                Text {
                    text: "Progress";
                    font-size: Theme.font-size-small;
                    color: Colors.on-surface-variant;
                }
                
                Text {
                    text: @tr("{:.0}%", project-data.progress-percentage);
                    font-size: Theme.font-size-small;
                    color: Colors.on-surface;
                    horizontal-alignment: right;
                }
            }
            
            Rectangle {
                height: 6px;
                border-radius: 3px;
                background: Colors.outline-variant;
                
                Rectangle {
                    height: 6px;
                    width: parent.width * project-data.progress-percentage / 100;
                    border-radius: 3px;
                    background: Colors.primary;
                }
            }
        }
        
        // Stats row
        HorizontalLayout {
            spacing: 16px;
            
            // Members
            HorizontalLayout {
                spacing: 4px;
                
                Text {
                    text: "👥";
                    font-size: 14px;
                }
                
                Text {
                    text: @tr("{}", project-data.member-count);
                    font-size: Theme.font-size-small;
                    color: Colors.on-surface-variant;
                }
            }
            
            // Documents
            HorizontalLayout {
                spacing: 4px;
                
                Text {
                    text: "📄";
                    font-size: 14px;
                }
                
                Text {
                    text: @tr("{}", project-data.document-count);
                    font-size: Theme.font-size-small;
                    color: Colors.on-surface-variant;
                }
            }
            
            // Tasks
            HorizontalLayout {
                spacing: 4px;
                
                Text {
                    text: "✓";
                    font-size: 14px;
                }
                
                Text {
                    text: @tr("{}", project-data.task-count);
                    font-size: Theme.font-size-small;
                    color: Colors.on-surface-variant;
                }
            }
            
            Rectangle { } // Spacer
            
            // Last activity
            Text {
                text: project-data.last-activity;
                font-size: Theme.font-size-small;
                color: Colors.on-surface-variant;
                horizontal-alignment: right;
            }
        }
    }
    
    states [
        hovered when touch.has-hover: {
            hovered: true;
        }
        pressed when touch.pressed: {
            background: Colors.primary-light.with-alpha(0.5);
        }
    ]
}

// Compact list item for list view
export component ProjectListItem inherits Rectangle {
    in property <ProjectCardData> project-data;
    in property <bool> selected: false;
    in property <bool> hovered: false;
    
    callback clicked(ProjectCardData);
    callback context-menu(ProjectCardData, length, length);
    callback favorite-clicked(ProjectCardData);
    
    width: 100%;
    height: 80px;
    background: selected ? Colors.primary-light : (hovered ? Colors.surface-variant : transparent);
    border-radius: 4px;
    
    touch := TouchArea {
        clicked => {
            root.clicked(root.project-data);
        }
        
        mouse-cursor: pointer;
        
        right-clicked => {
            root.context-menu(root.project-data, self.mouse-x, self.mouse-y);
        }
    }
    
    HorizontalLayout {
        padding: 12px;
        spacing: 16px;
        alignment: center;
        
        // Thumbnail/Icon
        Rectangle {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: Colors.primary.with-alpha(0.1);
            
            Text {
                text: project-data.name.substring(0, 1).to-uppercase();
                font-size: 20px;
                font-weight: 600;
                color: Colors.primary;
            }
        }
        
        // Main content
        VerticalLayout {
            spacing: 4px;
            
            // Title and badges row
            HorizontalLayout {
                spacing: 12px;
                alignment: center;
                
                Text {
                    text: project-data.name;
                    font-size: Theme.font-size-h5;
                    font-weight: 600;
                    color: Colors.on-surface;
                    overflow: elide;
                }
                
                // Status
                Rectangle {
                    border-radius: 8px;
                    background: project-data.status-color.with-alpha(0.1);
                    
                    HorizontalLayout {
                        padding-left: 6px;
                        padding-right: 6px;
                        padding-top: 2px;
                        padding-bottom: 2px;
                        spacing: 2px;
                        
                        Text {
                            text: project-data.status-icon;
                            font-size: 10px;
                        }
                        
                        Text {
                            text: project-data.status;
                            font-size: Theme.font-size-caption;
                            color: project-data.status-color;
                        }
                    }
                }
                
                // Priority
                Rectangle {
                    border-radius: 8px;
                    background: project-data.priority-color.with-alpha(0.1);
                    
                    HorizontalLayout {
                        padding-left: 6px;
                        padding-right: 6px;
                        padding-top: 2px;
                        padding-bottom: 2px;
                        spacing: 2px;
                        
                        Text {
                            text: project-data.priority-icon;
                            font-size: 10px;
                        }
                        
                        Text {
                            text: project-data.priority;
                            font-size: Theme.font-size-caption;
                            color: project-data.priority-color;
                        }
                    }
                }
            }
            
            // Description and stats
            HorizontalLayout {
                spacing: 16px;
                alignment: center;
                
                Text {
                    text: project-data.description;
                    font-size: Theme.font-size-small;
                    color: Colors.on-surface-variant;
                    overflow: elide;
                }
                
                Rectangle { } // Spacer
                
                // Quick stats
                HorizontalLayout {
                    spacing: 12px;
                    
                    Text {
                        text: @tr("{}% complete", project-data.progress-percentage);
                        font-size: Theme.font-size-small;
                        color: Colors.on-surface-variant;
                    }
                    
                    Text {
                        text: project-data.last-activity;
                        font-size: Theme.font-size-small;
                        color: Colors.on-surface-variant;
                    }
                }
            }
        }
        
        // Action buttons
        HorizontalLayout {
            spacing: 8px;
            
            // Favorite
            Rectangle {
                width: 32px;
                height: 32px;
                border-radius: 16px;
                background: project-data.is-favorite ? Colors.primary : transparent;
                
                Text {
                    text: project-data.is-favorite ? "⭐" : "☆";
                    color: project-data.is-favorite ? Colors.on-primary : Colors.on-surface-variant;
                    font-size: 16px;
                }
                
                favorite-touch := TouchArea {
                    mouse-cursor: pointer;
                    clicked => {
                        root.favorite-clicked(root.project-data);
                    }
                }
            }
        }
    }
    
    states [
        hovered when touch.has-hover: {
            hovered: true;
        }
        pressed when touch.pressed: {
            background: Colors.primary-light.with-alpha(0.3);
        }
    ]
}

// Preview pane component for project details
export component ProjectPreviewPane inherits Rectangle {
    in property <ProjectCardData> project-data;
    in property <bool> visible: false;
    
    width: 320px;
    background: Colors.surface;
    border-width: 1px;
    border-color: Colors.outline-variant;
    border-radius: 8px;
    
    if !visible: Rectangle { }
    
    if visible: ScrollView {
        VerticalLayout {
            padding: 20px;
            spacing: 16px;
            
            // Header
            VerticalLayout {
                spacing: 8px;
                
                Text {
                    text: project-data.name;
                    font-size: Theme.font-size-h3;
                    font-weight: 600;
                    color: Colors.on-surface;
                    wrap: word-wrap;
                }
                
                Text {
                    text: project-data.description;
                    font-size: Theme.font-size-body;
                    color: Colors.on-surface-variant;
                    wrap: word-wrap;
                }
            }
            
            // Status and Priority
            HorizontalLayout {
                spacing: 12px;
                
                Rectangle {
                    border-radius: 12px;
                    background: project-data.status-color.with-alpha(0.1);
                    border-width: 1px;
                    border-color: project-data.status-color;
                    
                    HorizontalLayout {
                        padding: 8px;
                        spacing: 6px;
                        
                        Text {
                            text: project-data.status-icon;
                            font-size: 16px;
                        }
                        
                        Text {
                            text: project-data.status;
                            font-size: Theme.font-size-body;
                            color: project-data.status-color;
                            font-weight: 500;
                        }
                    }
                }
                
                Rectangle {
                    border-radius: 12px;
                    background: project-data.priority-color.with-alpha(0.1);
                    border-width: 1px;
                    border-color: project-data.priority-color;
                    
                    HorizontalLayout {
                        padding: 8px;
                        spacing: 6px;
                        
                        Text {
                            text: project-data.priority-icon;
                            font-size: 16px;
                        }
                        
                        Text {
                            text: project-data.priority;
                            font-size: Theme.font-size-body;
                            color: project-data.priority-color;
                            font-weight: 500;
                        }
                    }
                }
            }
            
            // Progress
            VerticalLayout {
                spacing: 8px;
                
                HorizontalLayout {
                    Text {
                        text: "Overall Progress";
                        font-size: Theme.font-size-body;
                        color: Colors.on-surface;
                        font-weight: 500;
                    }
                    
                    Text {
                        text: @tr("{:.1}%", project-data.progress-percentage);
                        font-size: Theme.font-size-body;
                        color: Colors.primary;
                        font-weight: 600;
                        horizontal-alignment: right;
                    }
                }
                
                Rectangle {
                    height: 8px;
                    border-radius: 4px;
                    background: Colors.outline-variant;
                    
                    Rectangle {
                        height: 8px;
                        width: parent.width * project-data.progress-percentage / 100;
                        border-radius: 4px;
                        background: Colors.primary;
                    }
                }
            }
            
            // Statistics
            VerticalLayout {
                spacing: 12px;
                
                Text {
                    text: "Project Statistics";
                    font-size: Theme.font-size-body;
                    color: Colors.on-surface;
                    font-weight: 500;
                }
                
                VerticalLayout {
                    spacing: 8px;
                    
                    HorizontalLayout {
                        Text {
                            text: "👤 Owner";
                            font-size: Theme.font-size-body;
                            color: Colors.on-surface-variant;
                        }
                        
                        Text {
                            text: project-data.owner-name;
                            font-size: Theme.font-size-body;
                            color: Colors.on-surface;
                            horizontal-alignment: right;
                        }
                    }
                    
                    HorizontalLayout {
                        Text {
                            text: "👥 Team Members";
                            font-size: Theme.font-size-body;
                            color: Colors.on-surface-variant;
                        }
                        
                        Text {
                            text: @tr("{}", project-data.member-count);
                            font-size: Theme.font-size-body;
                            color: Colors.on-surface;
                            horizontal-alignment: right;
                        }
                    }
                    
                    HorizontalLayout {
                        Text {
                            text: "📄 Documents";
                            font-size: Theme.font-size-body;
                            color: Colors.on-surface-variant;
                        }
                        
                        Text {
                            text: @tr("{}", project-data.document-count);
                            font-size: Theme.font-size-body;
                            color: Colors.on-surface;
                            horizontal-alignment: right;
                        }
                    }
                    
                    HorizontalLayout {
                        Text {
                            text: "✓ Tasks";
                            font-size: Theme.font-size-body;
                            color: Colors.on-surface-variant;
                        }
                        
                        Text {
                            text: @tr("{}", project-data.task-count);
                            font-size: Theme.font-size-body;
                            color: Colors.on-surface;
                            horizontal-alignment: right;
                        }
                    }
                    
                    if project-data.due-date != "": HorizontalLayout {
                        Text {
                            text: "📅 Due Date";
                            font-size: Theme.font-size-body;
                            color: Colors.on-surface-variant;
                        }
                        
                        Text {
                            text: project-data.due-date;
                            font-size: Theme.font-size-body;
                            color: Colors.on-surface;
                            horizontal-alignment: right;
                        }
                    }
                }
            }
            
            // Recent Activity
            VerticalLayout {
                spacing: 8px;
                
                Text {
                    text: "Recent Activity";
                    font-size: Theme.font-size-body;
                    color: Colors.on-surface;
                    font-weight: 500;
                }
                
                Text {
                    text: @tr("Last updated {}", project-data.last-activity);
                    font-size: Theme.font-size-body;
                    color: Colors.on-surface-variant;
                }
            }
        }
    }
}